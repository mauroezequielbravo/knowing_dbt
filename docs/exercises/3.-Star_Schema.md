# Ejercicio 3: Modelo Estrella - Arquitectura Dimensional Completa

## ğŸ“Œ Contexto
Necesitas construir un modelo dimensional completo para analizar ventas de un e-commerce. El objetivo es crear una arquitectura que permita anÃ¡lisis complejos y reportes eficientes usando el patrÃ³n de modelo estrella.

## ğŸ“‚ Dataset
Usar los mismos archivos del Ejercicio 1:
- `raw_customers.csv`
- `raw_products.csv` 
- `raw_orders.csv`

## ğŸ¯ Arquitectura Objetivo
```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ fact_orders â”‚
                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                     â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚dim_customersâ”‚       â”‚dim_productsâ”‚       â”‚ dim_date  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Tareas

### 1. PreparaciÃ³n
AsegÃºrate de que los modelos staging estÃ©n funcionando:
```bash
docker-compose exec dbt dbt run --models staging --project-dir=/usr/app/knowing_dbt
```

### 2. Crear Modelos Intermedios

#### a. int_orders_enriched.sql
Crear en `models/intermediate/` un modelo que:
- Una Ã³rdenes con clientes y productos usando LEFT JOIN
- Calcule mÃ©tricas como `total_amount`
- Agregue dimensiones de tiempo (aÃ±o, mes, dÃ­a de la semana, nombre del mes, nombre del dÃ­a)
- Incluya todas las columnas relevantes de las tres tablas

### 3. Crear Dimensiones

#### a. dim_customers.sql
Crear dimensiÃ³n de clientes que incluya:
- Todas las columnas bÃ¡sicas del cliente
- MÃ©tricas agregadas: total de pedidos, total gastado, valor promedio por pedido
- Fecha del Ãºltimo pedido
- SegmentaciÃ³n del cliente basada en el total gastado (VIP, Regular, Nuevo)

#### b. dim_products.sql
Crear dimensiÃ³n de productos que incluya:
- Todas las columnas bÃ¡sicas del producto
- MÃ©tricas agregadas: total de pedidos, cantidad total vendida, ingresos totales
- Cantidad promedio por pedido
- CategorÃ­a de rendimiento basada en ingresos (Alto, Medio, Bajo rendimiento)

#### c. dim_date.sql
Crear dimensiÃ³n de tiempo que incluya:
- Generar un spine de fechas para todo el aÃ±o 2023
- Extraer componentes de fecha: aÃ±o, mes, dÃ­a, trimestre
- Nombres de meses y dÃ­as de la semana
- Indicadores de tipo de dÃ­a (laboral vs fin de semana)
- Estaciones del aÃ±o

### 4. Crear Tabla de Hechos

#### a. fact_orders.sql
Crear tabla de hechos que incluya:
- Todas las columnas de identificaciÃ³n (order_id, customer_id, product_id)
- Clave de fecha para uniÃ³n con dim_date
- MÃ©tricas de cantidad y precio
- MÃ©tricas por estado (delivered_amount, cancelled_amount, shipped_amount)
- MÃ©tricas de tiempo (dÃ­as desde que el cliente se registrÃ³)
- Timestamps de auditorÃ­a

### 5. Tests del Modelo Estrella

Implementar tests para validar la integridad del modelo estrella:

#### Para dim_customers:
- **customer_id**: Debe ser Ãºnico y no nulo
- **total_spent**: Debe ser un valor no nulo
- **customer_segment**: Debe ser uno de los valores vÃ¡lidos (VIP, Regular, Nuevo)

#### Para dim_products:
- **product_id**: Debe ser Ãºnico y no nulo
- **total_revenue**: Debe ser un valor no nulo
- **performance_category**: Debe ser uno de los valores vÃ¡lidos (Alto, Medio, Bajo rendimiento)

#### Para dim_date:
- **date_key**: Debe ser Ãºnico y no nulo
- **day_type**: Debe ser uno de los valores vÃ¡lidos (DÃ­a laboral, Fin de semana)

#### Para fact_orders:
- **order_id**: Debe ser Ãºnico y no nulo
- **customer_id**: Debe existir en dim_customers
- **product_id**: Debe existir en dim_products
- **date_key**: Debe existir en dim_date
- **total_amount**: Debe ser un valor positivo

### 6. DocumentaciÃ³n Completa

Crear documentaciÃ³n completa en `schema.yml` que incluya:

#### Para fact_orders:
- DescripciÃ³n general de la tabla de hechos
- DescripciÃ³n de columnas clave: order_id, total_amount, delivered_amount, cancelled_amount

#### Para dim_customers:
- DescripciÃ³n de la dimensiÃ³n de clientes
- DescripciÃ³n de columnas: customer_id, total_spent, customer_segment

#### Para dim_products:
- DescripciÃ³n de la dimensiÃ³n de productos
- DescripciÃ³n de columnas: product_id, total_revenue, performance_category

#### Para dim_date:
- DescripciÃ³n de la dimensiÃ³n de tiempo
- DescripciÃ³n de columnas: date_key, day_type, season

### 7. Ejecutar y Validar

Ejecutar todos los modelos del mart y validar que:
- Todos los modelos se construyan correctamente
- Los tests pasen sin errores
- La documentaciÃ³n se genere correctamente

## âœ… Resultados Esperados
- **fact_orders**: 8 registros con todas las mÃ©tricas calculadas
- **dim_customers**: 6 clientes con mÃ©tricas agregadas
- **dim_products**: 8 productos con mÃ©tricas de ventas
- **dim_date**: 365 dÃ­as del aÃ±o 2023
- Tests pasando sin errores
- DocumentaciÃ³n completa y navegable

## ğŸ” Conceptos Clave Aprendidos
- **Modelo Estrella**: SeparaciÃ³n clara entre hechos y dimensiones
- **NormalizaciÃ³n vs DesnormalizaciÃ³n**: OptimizaciÃ³n para consultas analÃ­ticas
- **MÃ©tricas Agregadas**: CÃ¡lculos pre-computados en dimensiones
- **Integridad Referencial**: Tests de relaciones entre tablas
- **DocumentaciÃ³n**: DescripciÃ³n completa de la arquitectura 